System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/geometry/projection","esri/widgets/Popup","esri/core/reactiveUtils","esri/widgets/Feature","esri/core/Handles"],(function(e,t){var n={},a={},i={},r={},c={},l={},o={},u={};return{setters:[function(e){n.React=e.React,n.appActions=e.appActions,n.getAppStore=e.getAppStore},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent,a.MapViewManager=e.MapViewManager},function(e){i.Label=e.Label,i.Loading=e.Loading,i.Switch=e.Switch,i.Tab=e.Tab,i.Tabs=e.Tabs},function(e){r.default=e.default},function(e){c.default=e.default},function(e){l.default=e.default},function(e){o.default=e.default},function(e){u.default=e.default}],execute:function(){e((()=>{var e={4312:e=>{"use strict";e.exports=u},2243:e=>{"use strict";e.exports=l},6333:e=>{"use strict";e.exports=r},9177:e=>{"use strict";e.exports=o},6949:e=>{"use strict";e.exports=c},2686:e=>{"use strict";e.exports=a},9244:e=>{"use strict";e.exports=n},4321:e=>{"use strict";e.exports=i}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var d={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(d),s.d(d,{__set_webpack_public_path__:()=>R,default:()=>S});var e=s(9244),t=s(2686),n=s(4321),a=s(6333),i=s(6949),r=s(2243),c=s(9177),l=s(4312);const o=t=>{const a=t.message;return e.React.createElement(n.Tabs,{fill:!0,type:"underline",scrollable:!0},a?a.map((t=>{var a,i;const r={__html:t.innerHTML};if(null===(a=t.children[0])||void 0===a?void 0:a.children[0].innerText)return e.React.createElement(n.Tab,{title:null===(i=t.children[0])||void 0===i?void 0:i.children[0].innerText,id:t.id},e.React.createElement("div",{dangerouslySetInnerHTML:r}))})):e.React.createElement(e.React.Fragment,null))};var u=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function c(e){try{o(a.next(e))}catch(e){r(e)}}function l(e){try{o(a.throw(e))}catch(e){r(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,l)}o((a=a.apply(e,t||[])).next())}))};const{useRef:p,useState:f,useEffect:m}=e.React,h=t=>{const n=()=>{for(let e=0;e<a.current.length;e++)a.current[e].remove();a.current=[]};try{n()}catch(e){}const a=p([]),i=p([]),[r,s]=f([]),d=t.event,h=t.featureContainer,v=t.mapView.view,g=t.sidebarId;let w=!1;return m((()=>{t.on||(n(),i.current=[],s(i.current))}),[t.on]),m((()=>{n(),v.popup.fetchFeatures(d).then((t=>u(void 0,void 0,void 0,(function*(){i.current=[];let r=new l.default;const o=yield t.allGraphicsPromise,d=[];if(o.length>0){for(let e=0;e<o.length;e++)0===e?d.push(o[e].layer):d.includes(o[e].layer)||d.push(o[e].layer);d.forEach(((e,t)=>u(void 0,void 0,void 0,(function*(){const n=yield v.whenLayerView(e),l=document.createElement("div");l.className="container";const u=document.createElement("h3");u.innerHTML=e.title,l.appendChild(u),h.appendChild(l),o.forEach(((o,u)=>{if(o.layer===e){if("feature"===n.layer.type&&"function"==typeof n.highlight){const e=r.add(n.highlight(o));a.current.push(e),w=!0}const e=new c.default({container:document.createElement("div"),graphic:o,map:v.map,spatialReference:v.spatialReference,defaultPopupTemplateEnabled:!0});l.appendChild(e.container);const s=document.createElement("div");s.id=`resultContainer${t}_${u}`,s.appendChild(l),i.current.push(s)}}))}))))}setTimeout((()=>{s(i.current),w?(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(`widget_${g}`,"collapse",!0)):n()}),300)}))))}),[d]),e.React.createElement("div",null,r.length>0?e.React.createElement(o,{message:r}):e.React.createElement("div",null,t.on?e.React.createElement("p",null,"No Results Found"):e.React.createElement("p",null,"Enable switch to identify features.")))},{useState:v,useEffect:g}=e.React,w=t=>{const[a,i]=v(!1),c=t.mapView;return g((()=>{if(t.event.eventId)i(!0);else{i(!1);let e=0,t=0;c.view.allLayerViews.forEach((n=>{"feature"===n.layer.type&&n.layer.visible&&(e++,r.default.once((()=>!1===n.updating)).then((()=>{t++,t===e&&i(!0)})))})),e||i(!0),i(!0)}}),[t.event]),e.React.createElement("div",null,a?e.React.createElement(h,{mapView:c,event:t.event,featureContainer:t.featureContainer,on:t.on,sidebarId:t.sidebarId}):e.React.createElement(n.Loading,null))},{useState:y,useEffect:E,useRef:b}=e.React,S=c=>{var l,o;const u=c.config.sidebarWidgetId,s=t.MapViewManager.getInstance(),d=s.getJimuMapViewById(s.getAllJimuMapViewIds()[0]),[p,f]=y(d),[m,h]=y(null),[v,g]=y(null),[S,R]=y(!0),M=b(null);E((()=>{p&&r.default.whenOnce((()=>p.view.ready)).then((()=>{p.view.popup=new i.default({defaultPopupTemplateEnabled:!0,popupEnabled:!0}),M.current=C()}))}),[p]),E((()=>{var t;(null===(t=c.mutableStateProps)||void 0===t?void 0:t.newSearch)&&((0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(`widget_${u}`,"collapse",!1)),setTimeout((()=>{r.default.when((()=>p.view.stationary&&!p.view.updating&&c.mutableStateProps.newSearch),(()=>{a.default.load().then((()=>{const e=p.view.toScreen(c.mutableStateProps.newSearch),t=document.getElementById("identifyDiv");t.innerHTML="",h(e),g(t),c.mutableStateProps.newSearch=null}))}))}),1e3))}),[null===(l=c.mutableStateProps)||void 0===l?void 0:l.newSearch]);const C=()=>{const t=d.view.on("immediate-click",(t=>{const n=document.getElementById("identifyDiv");n.innerHTML="",h(t),g(n),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(`widget_${u}`,"collapse",!1))}));return t};return e.React.createElement("div",{style:{height:"inherit",overflow:"auto"}},c.useMapWidgetIds&&1===c.useMapWidgetIds.length&&e.React.createElement(t.JimuMapViewComponent,{useMapWidgetId:null===(o=c.useMapWidgetIds)||void 0===o?void 0:o[0],onActiveViewChange:e=>{e&&f(e)}}),e.React.createElement("div",{className:"d-flex justify-content-center mt-2"},e.React.createElement(n.Label,null,S?"Disable Map Click Search Results":"Enable Map Click Search Results",e.React.createElement(n.Switch,{className:"ml-2","aria-label":"Click Search Switch",checked:S,onChange:()=>{if(S){M.current.remove();document.getElementById("identifyDiv").innerHTML="",setTimeout((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(`widget_${u}`,"collapse",!1))}),500)}else M.current=C();R(!S)}}))),e.React.createElement("div",{id:"identifyDiv"},"Click the map to identify features."),m?e.React.createElement(w,{mapView:d,event:m,featureContainer:v,on:S,sidebarId:u}):e.React.createElement("div",null,S?e.React.createElement(e.React.Fragment,null):e.React.createElement("p",null,"Enable switch to identify features.")))};function R(e){s.p=e}})(),d})())}}}));